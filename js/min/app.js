"use strict";(function($,t){function e(t,e){return e.indexOf(t)>=0}var o=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,i=$("#hardcore"),s=!1,n=0,a=0,r=0,l=$("#input"),d=$("#progress"),u=0,c=$("#wordcount"),g=!1,h=null,p=0,w=[9,13,16,17,18,20,27,37,38,39,40,91,93],m={96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",222:"'"},f={",":"<",".":">","/":"?",";":":","'":'"',1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+"},v=!1,y=5,_=2;$("#email").on("keyup",function(){$(this).parents(".form-group").toggleClass("valid",o.test($("#email").val()))}).on("blur",function(){$(this).parents(".form-group").toggleClass("invalid",!o.test($("#email").val()))}),$("form").on("submit",function(t){if(t.preventDefault(),o.test($("#email").val())){l.val(atob(localStorage.getItem("mdwa.draft")));var e=$("#email").val();amplitude.getInstance().setUserId(e);var i=(new amplitude.Identify).setOnce("created_at",Math.floor(Date.now()/1e3));amplitude.identify(i),amplitude.logEvent("sign_up"),localStorage.setItem("mdwa.email",e),localStorage.setItem("mdwa.returning","true"),T(0),I(),$("#die").addClass("returning").hide()}else $("form").addClass("shake"),setTimeout(function(){$("form").removeClass("shake")},1e3)});var C=function t(){d.width(100*u+"%")},b=function t(){a=l.val().split(/\s+/).length,c.text(a+(1==a?" word":" words"))},x=function t(){var e=k()-p;localStorage.setItem("mdwa.draft",btoa(l.val())),amplitude.logEvent("stop_writing",{session_type:session_type,session_limit:session_limit,duration:e,won:!1,words:a,dangers:n}),l.val(""),clearInterval(h),g=!1,$("#tweet").attr("href","https://twitter.com/intent/tweet?text=I+wrote+"+a+"+words+using+The+Most+Dangerous+Writing+App+-+until+it+deleted+everything+.+%23MDWA&url=http%3A%2F%2Fwww.themostdangerouswritingapp.com"),$("#tweet").text("I wrote "+a+" words using The Most Dangerous Writing App - until it deleted everything."),$("#die").show(),setTimeout(function(){$("#die").addClass("visible")},20)},I=function t(){clearInterval(h),g=!1,won=!0,d.addClass("won"),setTimeout(function(){d.addClass("hide")},3e3),v&&($("#hardcore").hide(),l.removeClass("hardcore")),$("#win").show(),$("#wordcount").hide()},D=function t(){var e=k()-p;return u=("timed"==session_type?e:a)/session_limit,r+=.1,C(),v&&(hardcore.style.opacity=r>.1?0:1),!won&&u>=1?(amplitude.logEvent("stop_writing",{session_type:session_type,session_limit:session_limit,duration:e,won:!0,words:a,dangers:n}),I()):r>y?x():void(r>_&&(s=!0,T((r-_)/(y-_))))},T=function t(e){0==e?(l.css("opacity",1),$("body").css("box-shadow","none"),d.removeClass("danger")):(l.css("opacity",1-e),$("body").css("box-shadow","inset 0px 0px "+Math.floor(100*e)+"px 0px rgba(242, 77, 77, "+.7*e+")"),d.addClass("danger"))},A=function t(e,o){var i=void 0;return m.hasOwnProperty(e)?i=m[e]:48<=e&&e<=90?(i=String.fromCharCode(e),o||(i=i.toLowerCase())):i="",o&&f.hasOwnProperty(i)&&(i=f[i]),i},M=function o(i){b();var a=i||t.event,l=a.keyCode||a.which,d=a.ctrlKey||a.metaKey;if(a.ctrlKey&&e(l,[78,192])&&(a.metaKey||a.altKey))return void $("body").toggleClass("night-mode");if(!(won||l&&e(l,w))){if(d&&e(l,[65,67,86,88]))return void a.preventDefault();hardcore&&(hardcore.innerHTML=A(l,a.shiftKey)),r=0,s&&n++,s=!1,g?T(0):(amplitude.logEvent("start_writing",{session_type:session_type,session_limit:session_limit}),g=!0,p=k(),h=setInterval(D,100))}};l.on("scroll",function(){$("#input-wrap").toggleClass("cut-top",this.scrollTop>0),$("#input-wrap").toggleClass("cut-bottom",this.scrollHeight-10>$(this).height()+this.scrollTop&&this.scrollHeight>$(this).height())}),l.on("keydown",M);var k=function t(){return(new Date).getTime()/1e3},K=function t(){return v?(i.show(),l.addClass("hardcore")):i.hide(),won&&I(),l.focus_end()};$("#download").on("click",function(){var t=l.val().replace(/[",.!-::']/g,""),e=t.indexOf(" ",25);t=t.substr(0,e>0?e:30);var o=(new Date).toLocaleDateString();$(this).attr("download",t+" (MDWA "+o+").txt").attr("href","data:application/octet-stream;charset=utf-8;base64,"+btoa(l.val()))}),K(),$("input.float-label").label_better({animationTime:250,easing:"ease-in-out",offset:-8})}).call(void 0,jQuery,window);