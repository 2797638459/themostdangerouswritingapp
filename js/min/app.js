"use strict";
/* FileSaver.js
 * A saveAs() FileSaver implementation.
 * 1.3.2
 * 2016-06-16 18:25:19
 *
 * By Eli Grey, http://eligrey.com
 * License: MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 */
/*global self */
/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */var saveAs=saveAs||function(d){// IE <10 is explicitly unsupported
if(!(void 0===d||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=d.document,u=function e(){return d.URL||d.webkitURL||d},m=e.createElementNS("http://www.w3.org/1999/xhtml","a"),f="download"in m,p=function e(t){var n=new MouseEvent("click");t.dispatchEvent(n)},g=/constructor/i.test(d.HTMLElement)||d.safari,w=/CriOS\/[\d]+/.test(navigator.userAgent),i=function e(t){(d.setImmediate||d.setTimeout)(function(){throw t},0)},h="application/octet-stream",o=4e4,v=function e(t){var n;setTimeout(function e(){"string"==typeof t?
// file is an object URL
u().revokeObjectURL(t):
// file is a File
t.remove()},o)},y=function e(t,n,o){for(var a=(n=[].concat(n)).length;a--;){var r=t["on"+n[a]];if("function"==typeof r)try{r.call(t,o||t)}catch(e){i(e)}}},b=function e(t){
// prepend BOM for UTF-8 XML and text/* types (including HTML)
// note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF
return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},a=function e(o,t,n){n||(o=b(o));// First try a.download, then web filesystem, then object URLs
var a=this,r,i=o.type===h,s,l=function e(){y(a,"writestart progress write writeend".split(" "))}// on any filesys errors revert to saving with object URLs
,c=function e(){if((w||i&&g)&&d.FileReader){
// Safari doesn't allow downloading of blob urls
var n=new FileReader;return n.onloadend=function(){var e=w?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;"),t;d.open(e,"_blank")||(d.location.href=e),e=void 0,// release reference before dispatching
a.readyState=a.DONE,l()},n.readAsDataURL(o),void(a.readyState=a.INIT)}// don't create more object URLs than needed
var t;(s||(s=u().createObjectURL(o)),i)?d.location.href=s:d.open(s,"_blank")||(
// Apple does not allow window.open, see https://developer.apple.com/library/safari/documentation/Tools/Conceptual/SafariExtensionGuide/WorkingwithWindowsandTabs/WorkingwithWindowsandTabs.html
d.location.href=s);a.readyState=a.DONE,l(),v(s)};if(a.readyState=a.INIT,f)return s=u().createObjectURL(o),void setTimeout(function(){m.href=s,m.download=t,p(m),l(),v(s),a.readyState=a.DONE});c()},t=a.prototype,n=function e(t,n,o){return new a(t,n||t.name||"download",o)};// IE 10+ (native saveAs)
return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=b(e)),navigator.msSaveOrOpenBlob(e,t)}:(t.abort=function(){},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,n)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);(function(r,i){function s(e,t){return 0<=t.indexOf(e)}var o=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,t=r("#hardcore"),l=!1,c=0,n=0,d=0,u=r("#input"),a=r("#progress"),m=0,f=r("#wordcount"),p=!1,g=null,w=0,h=[8,9,13,16,17,18,20,27,37,38,39,40,91,93],v={96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",222:"'"},y={",":"<",".":">","/":"?",";":":","'":'"',1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+"},e=5,b=2;
/* *************************************************************** */
/* Registration form validation                                    */
/* *************************************************************** */
r("#email").on("keyup",function(){r(this).parents(".form-group").toggleClass("valid",o.test(r("#email").val()))}).on("blur",function(){r(this).parents(".form-group").toggleClass("invalid",!o.test(r("#email").val()))}),r("form").on("submit",function(e){if(e.preventDefault(),o.test(r("#email").val())){
// Register user
u.val(decodeURIComponent(escape(atob(localStorage.getItem("mdwa.draft")))));var t=r("#email").val();amplitude.getInstance().setUserId(t);var n=(new amplitude.Identify).setOnce("created_at",Math.floor(Date.now()/1e3));amplitude.identify(n),amplitude.logEvent("sign_up",{email:t}),localStorage.setItem("mdwa.email",t),localStorage.setItem("mdwa.returning","true"),x(0),I(),r("#die").addClass("returning").hide()}else r("form").addClass("shake"),setTimeout(function(){r("form").removeClass("shake")},1e3)});
/* *************************************************************** */
/* Writing stuff                                                   */
/* *************************************************************** */
var _=function e(){a.width("".concat(100*m,"%"))},E=function e(){var t=u.val().trim();n=t.length&&t.split(/\s+/).length,f.text(n+(1==n?" word":" words"))},C=function e(){if(p){var t=k()-w;localStorage.setItem("mdwa.draft",btoa(unescape(encodeURIComponent(u.val())))),amplitude.logEvent("stop_writing",{session_type:session_type,session_limit:session_limit,duration:t,won:!1,words:n,dangers:c}),u.val(""),clearInterval(g),p=!1,r("#tweet").attr("href","https://twitter.com/intent/tweet?text=I+wrote+".concat(n,"+words+using+The+Most+Dangerous+Writing+App+-+until+it+deleted+everything+.+%23MDWA&url=http%3A%2F%2Fwww.themostdangerouswritingapp.com")),r("#tweet").text("I wrote ".concat(n," words using The Most Dangerous Writing App - until it deleted everything.")),r("#die").show(),setTimeout(function(){r("#die").addClass("visible")},20)}},I=function e(){clearInterval(g),p=!1,won=!0,a.addClass("won"),setTimeout(function(){a.addClass("hide")},3e3),""==u.val()&&u.val(decodeURIComponent(escape(atob(localStorage.getItem("mdwa.draft"))))),hardcore_mode&&(r("#hardcore").hide(),u.removeClass("hardcore")),r("#win").show(),r("#wordcount").hide()},S=function e(){var t=k()-w;return m=("timed"==session_type?t:n)/session_limit,d+=.1,_(),hardcore_mode&&(hardcore.style.opacity=.1<d?0:1),!won&&1<=m?(amplitude.logEvent("stop_writing",{session_type:session_type,session_limit:session_limit,duration:t,won:!0,words:n,dangers:c}),I()):5<d?C():void(2<d&&(l=!0,x((d-2)/3)))},x=function e(t){0==t?(u.css("opacity",1),r("body").css("box-shadow","none"),a.removeClass("danger")):(u.css("opacity",1-t),r("body").css("box-shadow","inset 0px 0px ".concat(Math.floor(100*t),"px 0px rgba(242, 77, 77, ").concat(.7*t,")")),a.addClass("danger"))},F=function e(t,n){var o;return v.hasOwnProperty(t)?o=v[t]:48<=t&&t<=90?(o=String.fromCharCode(t),n||(o=o.toLowerCase())):o="",n&&y.hasOwnProperty(o)&&(o=y[o]),o},O=function e(t){E();var n=t||i.event,o=n.keyCode||n.which,a=n.ctrlKey||n.metaKey;// Ctrl + (Alt or Cmd) + N -> Night Mode!
n.ctrlKey&&s(o,[78,192])&&(n.metaKey||n.altKey)?r("body").toggleClass("night-mode"):// If we have won, nothing to do
won||o&&s(o,h)||(// Prevent Ctrl + C (or a or v or x)
a&&s(o,[65,67,86,88])?n.preventDefault():(hardcore&&(hardcore.innerHTML=F(o,n.shiftKey)),d=0,// Add to dangers avoided
l&&c++,l=!1,p?x(0):(amplitude.logEvent("start_writing",{session_type:session_type,session_limit:session_limit}),p=!0,w=k(),g=setInterval(S,100))))};u.on("scroll",function(){r("#input-wrap").toggleClass("cut-top",0<this.scrollTop),r("#input-wrap").toggleClass("cut-bottom",this.scrollHeight-10>r(this).height()+this.scrollTop&&this.scrollHeight>r(this).height())}),u.on("keydown",O);var R=function e(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():
// current working methods
document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),u.focus_end()},T=function e(){r("body").toggleClass("night-mode"),r("body").hasClass("night-mode")?localStorage.setItem("mode","night-mode"):localStorage.setItem("mode",""),u.focus_end()},k=function e(){return(new Date).getTime()/1e3},A=function e(){return hardcore_mode?(t.show(),u.addClass("hardcore")):t.hide(),won&&I(),u.focus_end()};r("#toggle-night-mode").on("click",T),r("#toggle-fullscreen").on("click",R),r("#download").on("click",function(){var e=u.val().replace(/[",.!-::']/g,""),t=e.indexOf(" ",25);e=e.substr(0,0<t?t:30);var n=(new Date).toLocaleDateString(),o="".concat(e," (MDWA ").concat(n,").txt"),a=new Blob([u.val()],{type:"text/plain;charset=utf-8"});return saveAs(a,o),!1}),A(),r("input.float-label").label_better({animationTime:250,easing:"ease-in-out",offset:-8})}).call(void 0,jQuery,window);
//# sourceMappingURL=app.js.map